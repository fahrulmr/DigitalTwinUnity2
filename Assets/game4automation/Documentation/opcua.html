<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <title>gam4automation DOC - OPCUA</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300,700" rel="stylesheet" type="text/css">
  <link href="style/docs.css" rel="stylesheet">
</head>
<body>
  <div class="menu">
    <div class="logo">
      Content
    </div>
    <nav class="menu-nav">
      
        <ul class="nav">
          <span>Preparation</span>
          <ul class="nav">
            
              <li>
                <a href="installation.html">Installation</a>
              </li>
            
              <li>
                <a href="releasenotes.html">Release Notes</a>
              </li>
            
          </ul>
        </ul>
      
        <ul class="nav">
          <span>Basics</span>
          <ul class="nav">
            
              <li>
                <a href="userinterface.html">User Interface</a>
              </li>
            
              <li>
                <a href="runtimeui.html">Runtime UI</a>
              </li>
            
              <li>
                <a href="folderstructure.html">structure</a>
              </li>
            
              <li>
                <a href="importexport.html">Importing and exporting</a>
              </li>
            
              <li>
                <a href="demomodel.html">Demo Model</a>
              </li>
            
              <li>
                <a href="tutorial.html">Tutorial</a>
              </li>
            
              <li>
                <a href="physics.html">Physics</a>
              </li>
            
              <li>
                <a href="import3ddata.html">CAD import</a>
              </li>
            
              <li>
                <a href="cadlink.html">CADLink</a>
              </li>
            
              <li>
                <a href="pixyz.html">Import with PIXZ</a>
              </li>
            
              <li>
                <a href="cadupdater.html">CADUpdater</a>
              </li>
            
              <li>
                <a href="LargeAssemblies.html">Large Assemblies</a>
              </li>
            
              <li>
                <a href="SelectionWindow.html">Selection Window</a>
              </li>
            
              <li>
                <a href="CADChecker.html">CAD Checker</a>
              </li>
            
              <li>
                <a href="parts4cad.html">parts4cad</a>
              </li>
            
          </ul>
        </ul>
      
        <ul class="nav">
          <span>Components</span>
          <ul class="nav">
            
              <li>
                <a href="game4automation.html">Game4Automation</a>
              </li>
            
              <li>
                <a href="source.html">Source</a>
              </li>
            
              <li>
                <a href="sink.html">Sink</a>
              </li>
            
              <li>
                <a href="mu.html">MU</a>
              </li>
            
              <li>
                <a href="partchanger.html">PartChanger</a>
              </li>
            
              <li>
                <a href="motionaxis.html">Motions</a>
              </li>
            
              <li>
                <a href="group.html">Group</a>
              </li>
            
              <li>
                <a href="kinematic.html">Kinematics</a>
              </li>
            
              <li>
                <a href="drive.html">Drive</a>
              </li>
            
              <li>
                <a href="CAM.html">CAM</a>
              </li>
            
              <li>
                <a href="transportsurface.html">Transport Surface</a>
              </li>
            
              <li>
                <a href="drivebehaviour.html">Drive Behavior</a>
              </li>
            
              <li>
                <a href="chain.html">Chain</a>
              </li>
            
              <li>
                <a href="chainelement.html">Chain element</a>
              </li>
            
              <li>
                <a href="sensor.html">Sensor</a>
              </li>
            
              <li>
                <a href="sensor.html">Sensor</a>
              </li>
            
              <li>
                <a href="grip.html">Grip</a>
              </li>
            
              <li>
                <a href="lamp.html">Lamp</a>
              </li>
            
              <li>
                <a href="uicomponents.html">UI components</a>
              </li>
            
              <li>
                <a href="plc.html">PLC</a>
              </li>
            
              <li>
                <a href="interface.html">Automation Interfaces</a>
              </li>
            
              <li>
                <a href="s7tcpip.html">S7-TCPIP</a>
              </li>
            
              <li>
                <a href="twincat.html">TwinCAT</a>
              </li>
            
              <li>
                <a href="sharedmemory.html">Shared Memory</a>
              </li>
            
              <li>
                <a href="plcsimadvanced.html">PLCSIM Advanced</a>
              </li>
            
              <li>
                <a href="">OPC UA</a>
              </li>
            
              <li>
                <a href="robodk.html">RoboDK</a>
              </li>
            
              <li>
                <a href="modbus.html">Modbus</a>
              </li>
            
              <li>
                <a href="custominterfaces.html">Custom interfaces</a>
              </li>
            
              <li>
                <a href="playmaker.html">Visual Scripting</a>
              </li>
            
          </ul>
        </ul>
      
        <ul class="nav">
          <span>Advanced</span>
          <ul class="nav">
            
              <li>
                <a href="combilerdefines.html">Compiler Defines</a>
              </li>
            
              <li>
                <a href="assemblydefinitions.html">Assembly Defintions</a>
              </li>
            
              <li>
                <a href="yourown.html">Starting your own Project</a>
              </li>
            
          </ul>
        </ul>
      
    </nav>
    <a class="footer" href="https://game4automation.com">
      Game4Automation
    </a>
  </div>
  <div class="page">
   
    <div class="page-content">
	<p>This is the offline version of the documentation. We recommend you to use the <a href="https://game4automation.com/documentation/current/index.html">online documentation.</a></p>
 <h1 id="OPCUA-Interface-OPCUA4Unity"><a href="#OPCUA-Interface-OPCUA4Unity" class="headerlink" title="OPCUA Interface - OPCUA4Unity"></a>OPCUA Interface - OPCUA4Unity</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>OPCUA is a standard, maintained by the OPC foundation, for industrial communication. Most of the providers of automation devices´, like PLC and Robot manufacturers, are providing OPCUA servers. Sometimes the OPCUA server is directly integrated into the automation device and sometimes a special software neeeds to be installed on a PC. OPCUA is one impotant upcoming standard for Industry4.0.</p>
<p>For more information please check:<br><a href="https://opcfoundation.org/about/opc-technologies/opc-ua/" target="_blank" rel="noopener">https://opcfoundation.org/about/opc-technologies/opc-ua/</a></p>
<p>This OPCUA client interface for Unity is based on excellent technology from Träger Industry Components (<a href="https://www.traeger.de/)" target="_blank" rel="noopener">https://www.traeger.de/)</a>. Many thanks to Träger for supporing us.</p>
<blockquote>
<p>OPCUA4Unity is available as a standalone asset as well as part of Game4Automation Professional. The connection to the behavior models (PLCInputs and PLCOutputs) as well as the display of the Signals in the Hierarchy view is part of the Game4Automation Framework and not available in the OPCUA4Unity standalone asset.</p>
</blockquote>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>Both assets, Game4Automation Professional as well as OPCUA4Unity are installed by using the Unity Asset Store. </p>
<p>If you are using the Game4Automation Framework you are finding the OPCUA Interface after the installation under the path <em>game4automation/private/interfaces/OPCUA4Unity</em> If you are using the Standalone version you will find it under the path <em>OPCUA4Unity</em> in the Asset folder.</p>
<img src="images\opcua-path.png">
<p>if you are using the Game4Automation Professional version you can use OPCUA4Unity also independent from Game4Automation. You just need to move the full OPCUA4Unity folder to a new project.</p>
<h2 id="Demo-model"><a href="#Demo-model" class="headerlink" title="Demo model"></a>Demo model</h2><p>In the sub-folder, DemoModel we provide a small demo which is showing you how to use the OPCUA interface independent from the Game4Automation Framework. The demo model is working with a demo OPCUA Demo server (OPC UA C++ Demo Server V1.6.3 (Windows)) from Unified Automation (<a href="https://www.unified-automation.com/downloads/opc-ua-servers.html)" target="_blank" rel="noopener">https://www.unified-automation.com/downloads/opc-ua-servers.html)</a>. You can download the OPCUA server for free, if you register before at Unified Automation.</p>
<img src="images\opcua-demomodel.png">
<h2 id="Build-settings"><a href="#Build-settings" class="headerlink" title="Build settings"></a>Build settings</h2><p>Please use these build settings. Mono is also working. Depending on your destination device you might need to use IL2CPP.</p>
<img src="images\opcua-buildsettings.png">
<h2 id="Interface-Configuration"><a href="#Interface-Configuration" class="headerlink" title="Interface Configuration"></a>Interface Configuration</h2><p>If you are using Game4Automation you can use the tool-bar to add an OPCUA interface to your scene:<br><img src="images\opcua-addinterface.png"></p>
<p>Otherwise you will need to create an empty Gameobject and add the Script OPCUA_Interface to your Gameobject. </p>
<p>For the interface you will need to define at least</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Server</td>
<td>The address of the server, whether on your machine like the demo server or on an external device</td>
</tr>
<tr>
<td>Connect To Server</td>
<td>true to connect to the server. If false the opcua interface is inactive.</td>
</tr>
<tr>
<td>Auto Accept Server Certificates</td>
<td>true, will accept all Server certificates. Should be changed to false for productive environments.</td>
</tr>
<tr>
<td>Client Auto Generate Certificate</td>
<td>true, will generate a Certificate for a client if none is existing under the Certificate Path in the Streaming Assets folder. Should be changed in productive environments.</td>
</tr>
<tr>
<td>Use Only Secure Endpoints</td>
<td>false for test purposes. If true only secure endpoints are allowed.</td>
</tr>
<tr>
<td>Use High Level Endpoint Security</td>
<td>false for test purposes. If true always the highest security level the server is providing is used.</td>
</tr>
<tr>
<td>Top Node Id</td>
<td>The ID of the topnode under which all nodes should be imported. Please note, that you don’t need to import nodes if you would like to use them in your own script code. You can access in script any node the OPCUA server is importing.</td>
</tr>
</tbody>
</table>
<p>The rest of the interface parameters does not need to be changed if your Server is accepting anonymous access.</p>
<img src="images\opcua-inspector.png">
<h2 id="Connection-troubleshouting"><a href="#Connection-troubleshouting" class="headerlink" title="Connection troubleshouting"></a>Connection troubleshouting</h2><p>If you have problems in connecting to your OPCUA server please follow these steps.</p>
<ol>
<li>Make your own test model. Copy the demo scene and use the configuration  without security certificates. Please set server to the IP address of your OPC Server (e.g. opc.tcp://localhost:48010 if the server is running on the same machine):</li>
</ol>
<img src="images\opcua-demomodell.png">
<ol start="2">
<li><p>Use OpcWatch to check if you can reach the server from your machine. Download OpcWatch at this location:<br><a href="https://game4automation.com/download/OpcWatch.exe" target="_blank" rel="noopener">https://game4automation.com/download/OpcWatch.exe</a><br>Start OpcWatch on the computer you are running Unity and put in the adress of your OPCUA server:</p>
<img src="images\opcua-opcwatchip.png">
</li>
<li><p>Check with OpcWatch if it can connect to your OPC Server. Status of server should be shown as connected and you should be able to browse the sub nodes:</p>
<img src="images\opcua-watchconnection.png">
</li>
<li><p>If you are not able to browse the server check you server configuration. Your server should run with no security settings. No security certificates and passwords should be used for first tests.</p>
</li>
<li><p>If you are still unable to browse the server, try to ping the server in a command line (e.g. ping 192.168.0.32). If there is no response from the ping you should check your firewall settings. Please turn the firewall on the server and your computer off.</p>
</li>
<li><p>If you are able to browse the server get back to Unity. Check again, that in Unity the Server address in your model is the same as in your test with OpcWatch. Open the demo model and delete all sub nodes:</p>
<img src="images\opcua-deletedsubnodes.png">
</li>
<li><p>Select node id you where able to browse with OpcWatch and put it into the field <em>Top Node Id</em> of the OPCUA_Interface configuration. Then press import nodes:</p>
<img src="images\opcua-importnodes.png">
</li>
<li><p>You should now see the subnodes of your OPC UA server. In the Console you should see the message “Connected to OPC Client opc.tcp://192.168.0.32:48010 with Status Connected”</p>
</li>
<li><p>Compile the application on your target device (Windows, Android, IOs) and test it.</p>
</li>
<li><p>If your target device is not able to connect please check, if the build settings are set to <strong>.Net Standard 2.0 Compatibility</strong> level.</p>
</li>
<li><p>If you are still not able to connect on your target device please use a tool to see the log file on your target device like for example <a href="https://assetstore.unity.com/packages/tools/gui/in-game-debug-console-68068" target="_blank" rel="noopener">https://assetstore.unity.com/packages/tools/gui/in-game-debug-console-68068</a></p>
</li>
<li><p>Check the debug log on your mobile device. The log message should give you a hint about the problems on your mobile device.</p>
</li>
</ol>
<h2 id="Security-Certificates"><a href="#Security-Certificates" class="headerlink" title="Security Certificates"></a>Security Certificates</h2><p>OPC UA is using certificates to ensure a secure communication. If you selected <em>Auto Accept Server Certificates</em> and <em>Client Auto Generate Certificate</em> a Client certificate will be automatically generated and the server certificate is automatically added to the trusted certificate folder.</p>
<p>You can define the sub folder (to the home folder) for the certificates with <em>Certificate Path</em>. Because Unity needs access to this folder the home folder is on IOS and Android the Application.persistentDataPath or on Windows the <em>Application.streamingAssetsPath</em>.</p>
<h3 id="Generating-your-own-Application-certificate"><a href="#Generating-your-own-Application-certificate" class="headerlink" title="Generating your own Application certificate"></a>Generating your own Application certificate</h3><p>For generating your own certificate you need to download the UA configuration tool of the OPC UA foundation. You can download it here: <a href="http://www.opclabs.com/products/ua-configuration-tool" target="_blank" rel="noopener">http://www.opclabs.com/products/ua-configuration-tool</a></p>
<p>After downloading you can generate your own certificate with this command line. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files (x86)\UA Configuration Tool 1.03\Opc.Ua.CertificateGenerator.exe&quot; -sp . -an game4automation</span><br></pre></td></tr></table></figure>
<blockquote>
<p>game4automation must be replaced with your application name and must be the same as the <em>Application Name</em> in the properties of the OPC UA interface.</p>
</blockquote>
<p>This will generate you two folders, <em>certs</em> and <em>private</em> in the directory where you started *Opc.UA.CertificateGenerator.exe”. You need to copy these two folders into the StreamingAssetsPath.</p>
<p>To define your certificate you must enter the subpath (under the StreamingAssetsPath) of the .pfx file into the property <em>Client Certificate Path</em>:</p>
<img src="images\opcua-certificates.png">
<h2 id="Importing-OPCUA-Nodes"><a href="#Importing-OPCUA-Nodes" class="headerlink" title="Importing OPCUA Nodes"></a>Importing OPCUA Nodes</h2><p>If the interface is configured and the server is accessible you can import the Nodes from the OPCUA server.</p>
<p>Push on <em>Import Nodes</em> and all nodes (under the Top Node ID) are imported and generated as Gameobjects with attached OPCUA_Node Scripts:<br><img src="images\opcua-importnodes.png"></p>
<p>The OPCUA_Node Script is showing the Node information imported from the OPCUA server:<br><img src="images\opcua-node.png"></p>
<p>With the Button <em>Update Node</em> the data can be updated from the server.</p>
<p>If the Game4Automation framework is installed, additionally all corresponding PLCSignals are created. These signals can be dragged and dropped with sensors or drives of the Game4Automation framework.</p>
<p>When you now start the Simulation the OPCUA signals will be exchanged between Unity and the OPCUA Server.</p>
<h2 id="OPCUA-Nodes-with-Game4Automation-PLCInputs-and-PLCOutputs"><a href="#OPCUA-Nodes-with-Game4Automation-PLCInputs-and-PLCOutputs" class="headerlink" title="OPCUA Nodes with Game4Automation PLCInputs and PLCOutputs"></a>OPCUA Nodes with Game4Automation PLCInputs and PLCOutputs</h2><blockquote>
<p>This section is only valid for customers who are using Game4Automation together with OPCUA4Unity. OPCUA4Unity is included in Game4Automation Professional. </p>
</blockquote>
<p>The OPCUA interface uses in the source code several compile switches based on the Define <em>Game4Automation</em> to define a special behavior for Game4Automation. During signal import to all imported OPCUA nodes the corresponding PLCInputs and PLCOutput signals are added. PLCOutputs are automatically subscribed on the OPCUA server. PLCInputs should not be subscribed, because they are sent to the OPCUA server by Unity.<br><img src="images\opcua-signal.png"></p>
<p>Because in most cases it is not possible to determine, if the OPCUA node should be a PLC input or a PLC output, the booleans <em>Write Value</em>, what means that the value is written to the OPCUA server and <em>Read Value</em>, what means that the value is read from the OPCUA server. Based on this and on the data type the corresponding PLCInput or PLCOutput script is added to the OPCUA node.</p>
<blockquote>
<p>It is not possible to define an OPCUA node at the same time as PLCInput and PLCOutput. If you try to do that a warning message will be displayed in the log and no PLCInput or PLCOutput script will be added. If you want to use one node as input and output you need to code the interaction yourself (see below).</p>
</blockquote>
<p>It is possible to define a RegEx in the OPCUA interface configuration to determine automatically which OPCUA symbols should be treated as Input or Output during signal import. One ore multiple Regex can be defined symbol names or parts of symbol names which should be treated as Write Signals - that means PLCInputs or outputs from Unity.</p>
<p>If you change anything on the above described Game4Automation related settings you can update all imported nodes by pushing on the button <em>Update nodes</em></p>
<h2 id="Using-OPCUA-Nodes"><a href="#Using-OPCUA-Nodes" class="headerlink" title="Using OPCUA Nodes"></a>Using OPCUA Nodes</h2><p>You find a <a href"https:="" game4automation.com="" documentation="" current="" apidoc="" html="" classgame4automation_1_1_o_p_c_u_a___interface.html"=""> full API class documentation</a> online.</p>
<p>This section give you just an overview how to use OPCUA nodes based on the demo model.</p>
<h3 id="Reading-Values"><a href="#Reading-Values" class="headerlink" title="Reading Values"></a>Reading Values</h3><p>For reading values you can use two methods.</p>
<h4 id="Direct-reading"><a href="#Direct-reading" class="headerlink" title="Direct reading"></a><strong>Direct reading</strong></h4><p>First one (not recommended one) is to read directly from the OPCUA server with the commands</p>
<figure class="highlight c"><figcaption><span>PLC_CanConveyor#</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var myvar = Interface.ReadNodeValue (<span class="string">"ns=2;s=Demo.Dynamic.Scalar.UInt64"</span>)</span><br></pre></td></tr></table></figure>
<p>You can find this methods on the OPCUA_Node Script as well as on the interface itself. If you have a direct reference to the Interface in your method you can do like this:</p>
<figure class="highlight c"><figcaption><span>PLC_CanConveyor#</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> game4automation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoReadNodeNotRecommended</span> :</span> MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> OPCUA_Interface Interface;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> NodeId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">float</span> myvar = (<span class="keyword">float</span>)Interface.ReadNodeValue(NodeId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>This method is not recommended because the read is not done multithreaded and this might block or slow your application.</p>
</blockquote>
<h4 id="Subscribing-to-node-value-changes"><a href="#Subscribing-to-node-value-changes" class="headerlink" title="Subscribing to node value changes"></a><strong>Subscribing to node value changes</strong></h4><p>This is the recommended method. Here is an example:</p>
<figure class="highlight c"><figcaption><span>PLC_CanConveyor#</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> game4automation;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoMoveCubeWithDelegate</span>:</span> MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> OPCUA_Interface Interface;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> NodeId;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> PositionY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OPCUA_Node node;</span><br><span class="line">    <span class="keyword">private</span> OPCUANodeSubscription subscription;    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (Interface != null)</span><br><span class="line">                subscription = Interface.Subscribe(NodeId, NodeChanged);   <span class="comment">/// Subscribe to the nodeid with NodeChanged</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NodeChanged</span><span class="params">(OPCUANodeSubscription sub, object obj)</span>  <span class="comment">// Is called when Node Value of Node nodeid is changed</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        PositionY = (<span class="keyword">float</span>) obj;    <span class="comment">// sets the new position based on the new value </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      transform.rotation = Quaternion.Euler(<span class="keyword">new</span> Vector3(<span class="number">0</span>,PositionY,<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Writing-Values"><a href="#Writing-Values" class="headerlink" title="Writing Values"></a>Writing Values</h3><p>Also for node writing there are two methods. One blocking one, which is not recommended, and one which is done in a parallel thread:</p>
<h4 id="Direct-writing"><a href="#Direct-writing" class="headerlink" title="Direct writing"></a><strong>Direct writing</strong></h4><p>This is an example of direct writing (not recommended)</p>
<figure class="highlight c"><figcaption><span>PLC_CanConveyor#</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> success = Interface.WriteNodeValue (<span class="string">"ns=2;s=Demo.Dynamic.Scalar.Float"</span>,<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Writing-by-a-parallel-task-which-is-watching-the-node"><a href="#Writing-by-a-parallel-task-which-is-watching-the-node" class="headerlink" title="Writing by a parallel task which is watching the node"></a><strong>Writing by a parallel task which is watching the node</strong></h4><p>The recommended way for writing is to add a “WatchedNode” to the interface. With the Method <em>AddWatchedNode</em> you get a Node object back. This Node object will be watched automatically by a parallel task and each time the <em>Value</em> of the Node object is changing, the parallel task will update the server. This is non blocking because it happens in a total parallel task. See an example here:</p>
<figure class="highlight c"><figcaption><span>PLC_CanConveyor#</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> game4automation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoWriteNodeToServer</span> :</span> MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> Speed;</span><br><span class="line">    <span class="keyword">public</span> OPCUA_Interface Interface;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> NodeId;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> Position;</span><br><span class="line">    <span class="keyword">private</span> OPCUANode node;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        node = Interface.AddWatchedNode(NodeId); <span class="comment">// Register node as watched node</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        transform.Rotate(Vector3.left, Speed * Time.deltaTime);   </span><br><span class="line">        Position = transform.rotation.eulerAngles.x; <span class="comment">// Just for displaying it</span></span><br><span class="line">        node.Value = (<span class="keyword">int</span>)transform.rotation.eulerAngles.x;  <span class="comment">// sets the new node value - because it is watched value will be automatically transfered to OPC Server</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For more information please check the <a href"https:="" game4automation.com="" documentation="" current="" apidoc="" html="" classgame4automation_1_1_o_p_c_u_a___interface.html"=""> online API class documentation</a> documentation. </p>
<h3 id="Calling-OPCUA-Methods"><a href="#Calling-OPCUA-Methods" class="headerlink" title="Calling OPCUA Methods"></a>Calling OPCUA Methods</h3><p>To call methods you can use <em>CallMethod</em>.</p>
<p>Note that ﬁrst the <em>NodeId</em> of the owner of the method has to be given and<br>then the NodeID <em>MethodID</em> of the method itself. <em>CallMethod</em> allows to pass multiple parameters to the called method. <em>CallMethod</em> returns the results in an object array.</p>
<figure class="highlight c"><figcaption><span>DemoCallMethod#</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> game4automation;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoCallMethod</span> :</span> MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> OPCUA_Interface Interface;   </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> NodeId;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> MethodId;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> MethodParameterA;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> MethodParameterB;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> Result;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> _a, _b;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// if parameter changed</span></span><br><span class="line">        <span class="keyword">if</span> (_a != MethodParameterA || _b != MethodParameterB)</span><br><span class="line">        &#123;</span><br><span class="line">            var res = Interface.CallMethod(NodeId, MethodId,MethodParameterA,MethodParameterB); <span class="comment">// calls a method with NodeID MethodID in Node NodeId with Parameters MethodParameterA and MethodParameterB</span></span><br><span class="line">            Result = (<span class="keyword">double</span>) res[<span class="number">0</span>]; <span class="comment">// The result is returned as an object array</span></span><br><span class="line">        &#125;</span><br><span class="line">        _a = MethodParameterA;</span><br><span class="line">        _b = MethodParameterB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>
	  <br>

	  <p><font size="1">&copy; 2019 in2Sight GmbH <a href="https://game4automation.com"> https://game4automation.com </a> - All rights reserved. No part of this publication may be reproduced, distributed, or transmitted in any form or by any means, including printing, saving, photocopying, recording, or other electronic or mechanical methods, without the prior written permission of the publisher.</font></p>
    </div>
	
  </div>
  <div class="switch-page">
    
    
  </div>
</body>
</html>